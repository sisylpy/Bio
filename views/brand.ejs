<!DOCTYPE html>
<html>
<head>
    <title>后台管理主页</title>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    　<meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!--<script src="/jquery-3.2.1.js"></script>-->
    <!--<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"-->
            <!--integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"-->
            <!--crossorigin="anonymous"></script>-->
    <!--<script src="/bootstrap/js/bootstrap.min.js"></script>-->
    <!---->
    <!--<script src="/layer/layer.js"></script>-->

    <!--<script src="/pdfjs/build/pdf.js"></script>-->
    <!--<script src="/pdfjs/web/viewer.js"></script>-->

    <!--<link rel="stylesheet" href="/bootstrap/css/bootstrap.css">-->
    <!--<link rel="stylesheet" href="/layer/css/layer.css">-->
    <!--<link rel="stylesheet" href="/stylesheets/adminLogin.css">-->
    <!--<link rel="stylesheet" href="/stylesheets/adminNav.css">-->

    <!--<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>-->
    <!--<script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>-->
    <!--<script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>-->



        <!--&lt;!&ndash;[if lt IE 9]>-->
    <!--<script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>-->
    <!--<script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>-->
    <!--<![endif]&ndash;&gt;-->


    <script src="/jquery-3.2.1.js"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/layer/layer.js"></script>
    <script src="/pdfjs/build/pdf.js"></script>
    <script src="/pdfjs/web/viewer.js"></script>

    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/layer/css/layer.css">
    <link rel="stylesheet" href="/stylesheets/adminLogin.css">
    <link rel="stylesheet" href="/stylesheets/adminNav.css">

</head>


<body>

<div class="esjy-col">
    <!--导航菜单-->
    <%- include adminNav %>
    <!--子菜单-->
    <div class="subNav bg-dark ">
        <a class="navitem-name" href="javascript:;">品牌和经销商</a>
        <div class="subitems" id="myTabs">
            <a href="#brand_list" id="brand-tab" role="tab" data-toggle="pill" aria-controls="brand"
               class="showlist <% if(type == 0){ %>active  <% } %>"
               aria-expanded="true" data-type="0">品牌</a>
            <a href="#agency_list" id="agency-tab" role="tab" data-toggle="pill" aria-controls="agency"
               class="showlist <% if(type == 1){ %>active<% } %>"
               data-type="1">经销商</a>
            <!--<button type="button" class="btn btn-dark add-btn addNew" id="addNewBrand" target="_blank" data-toggle="modal" data-target="#addBrandNameModel">-->
                <!--<a href="javascript:;" target="_blank" data-toggle="modal" data-target="#addBrandNameModel">添加品牌</a>-->
            <!--</button>-->

            <button type="button" class="btn btn-dark add-btn addNew" id="addTest">
                <a href="javascript:;" target="_blank" data-toggle="modal" data-target="#addTestModel">添加品牌</a>
            </button>

            <button type="button" class="btn btn-dark add-btn addNew" id="addNewAgency">
                <a href="javascript:;" target="_blank" data-toggle="modal" data-target="#addAgencyNameModel">添加经销商</a>
            </button>
        </div>
    </div>
</div>


<!--<div class="alert alert-primary" role="alert">-->
    <!--This is a primary alert—check it out!-->
<!--</div>-->

<!--列表部分-->
<div class="container-fluid">
    <div class="bio row">
        <div class="col-sm-12">
            <div class="block20"></div>
            <div class="tab-content" id="tab-content">
                <!--品牌-->
                <div class="data-list tab-pane fade <% if(type == 0){ %>in active<% } %>" id="brand_list">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th class="has-success has-feedback brand-click-sort" style="cursor:pointer">
                                <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                品牌名称
                            </th>
                            <th>中文pdf数量</th>
                            <th>英文pdf数量</th>
                            <th>货号数量</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody class="text-left">
                        <% brandRes.forEach(function(brand, index){ %>
                        <tr>
                            <th scope="row"><%= index + 1 %></th>
                            <td><%= brand.manuName %></td>
                            <td><%= brand.z_count %></td>
                            <td><%= brand.e_count %></td>
                            <td><%= brand.item_count %></td>
                            <td>
                                <button id="edit-btn" type="button" class="btn btn-secondary">
                                    <a data-toggle="modal" data-target="#brandNameModel" data-id="<%= brand.id %>"
                                       data-name="<%= brand.manuName %>" href="javascript:;" target="_blank">修改</a>
                                </button>
                                <button id="delate-btn" type="button" class="btn btn-dark">
                                    <a class="delete_brand" data-id="<%= brand.id %>"
                                       data-z_count="<%= brand.z_count %>" data-e_count="<%= brand.e_count %>"
                                       href="javascript:;"
                                       target="_blank">删除</a>
                                </button>
                            </td>
                        </tr>
                        <% }) %>
                        </tbody>
                    </table>
                    <nav aria-label="Page navigation">
                        <ul class="pagination pull-right">
                            <li
                                    <% if(currentPage == 1){ %>
                                    class="disabled"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="1" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <% pageList.forEach(function(page){ %>
                            <li
                                    <% if(currentPage == page){ %>
                                    class="active"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="<%= page %>">
                                    <%= page %>
                                    <% if(currentPage == page){ %>
                                    <span class="sr-only">(current)</span>
                                    <% } %>
                                </a>
                            </li>
                            <% }) %>
                            <li
                                    <% if(currentPage == totalPage){ %>
                                    class="disabled"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="<%= totalPage %>" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!--经销商-->
                <div class="data-list tab-pane fade <% if(type == 1){ %>in active<% } %>" id="agency_list">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>序号</th>
                            <th class="has-success has-feedback agency-click-sort" style="cursor:pointer">
                                <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                经销商名称
                            </th>
                            <th>经销商状态</th>
                            <th>货品数量</th>
                            <th>货号数量</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody class="text-left" id="product_number_list">
                        <% agencyRes.forEach(function(agency, index){ %>
                        <tr>
                            <th scope="row"><%= index + 1 %></th>
                            <td><%= agency.agencyName %></td>
                            <td>
                                <% if(agency.agencyStatus == 'Y'){ %>
                                营业中
                                <% }else{ %>
                                停业
                                <% } %>
                            </td>
                            <td><%= agency.goods_count %></td>
                            <td><%= agency.item_count %></td>
                            <td>
                                <button id="edit-btn" type="button" class="btn btn-secondary">
                                    <a data-toggle="modal" data-target="#agencyNameModel"
                                       data-status="<%= agency.agencyStatus %>" data-id="<%= agency.id %>"
                                       data-name="<%= agency.agencyName %>" href="javascript:;" target="_blank">修改</a>
                                </button>
                                <button id="delate-btn" type="button" class="btn btn-dark">
                                    <a class="delete_agency" data-id="<%= agency.id %>"
                                       data-goods_count="<%= agency.goods_count %>" href="javascript:;" target="_blank">删除</a>
                                </button>
                            </td>
                        </tr>
                        <% }) %>
                        </tbody>
                    </table>
                    <nav aria-label="Page navigation">
                        <ul class="pagination pull-right">
                            <li
                                    <% if(currentPage == 1){ %>
                                    class="disabled"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="1" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <% pageList.forEach(function(page){ %>
                            <li
                                    <% if(currentPage == page){ %>
                                    class="active"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="<%= page %>">
                                    <%= page %>
                                    <% if(currentPage == page){ %>
                                    <span class="sr-only">(current)</span>
                                    <% } %>
                                </a>
                            </li>
                            <% }) %>
                            <li
                                    <% if(currentPage == totalPage){ %>
                                    class="disabled"
                                    <% } %>
                            >
                                <a href="javascript:;" class="page" data-page="<%= totalPage %>" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 修改品牌名称 -->
<div class="modal fade" id="brandNameModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">修改品牌名称</h4>
                <input type="hidden" name="brandId" value=""/>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">品牌名称:</label>
                        <input type="text" class="form-control" name="brandName" id="recipient-name">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="modify_brand_name">修改</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加品牌 -->
<div class="modal fade" id="addTestModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">品牌名称</h4>
                <input type="hidden" name="brandId" value=""/>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">品牌名称:</label>
                        <input type="text" class="form-control" name="addBrandName" id="recipient-name">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="add_brand">保存</button>
            </div>
        </div>
    </div>
</div>



<!--<div class="modal fade" id="addBrandNameModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">-->
    <!--<div class="modal-dialog" role="document">-->
        <!--<div class="modal-content">-->
            <!--<div class="modal-header">-->
                <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>-->
                <!--</button>-->
                <!--<h4 class="modal-title" id="exampleModalLabel">添加新品牌</h4>-->
            <!--</div>-->
            <!--<div class="modal-body">-->
                <!--<form>-->
                    <!--<div class="form-group">-->
                        <!--<label for="recipient-name" class="control-label">品牌名称:</label>-->
                        <!--<input type="text" class="form-control" name="addBrandName" id="recipient-name">-->
                    <!--</div>-->
                <!--</form>-->
            <!--</div>-->
            <!--<div class="modal-footer">-->
                <!--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
                <!--<button type="button" class="btn btn-primary" id="add_brand">确认</button>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->





<!-- 修改经销商名称 -->
<div class="modal fade" id="agencyNameModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">修改经销商名称</h4>
                <input type="hidden" name="agency_id" value=""/>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">经销商名称:</label>
                        <input type="text" class="form-control" name="agency_name" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">经销商状态:</label>
                        <select class="form-control" name="agency_status">
                            <option value="Y">营业中</option>
                            <option value="N">停业中</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="modify_agency_name">修改</button>
            </div>
        </div>
    </div>
</div>
<!-- 添加经销商 -->
<div class="modal fade" id="addAgencyNameModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="exampleModalLabel">添加新经销商</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">经销商名称:</label>
                        <input type="text" class="form-control" name="agencyName" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">经销商状态:</label>
                        <select class="form-control" name="agencyStatus">
                            <option value="Y">营业中</option>
                            <option value="N">停业中</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="add_agency">确认</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">



    $(function () {
    //    $('#addNewBrand').on('click',function () {
      //      alert('vvvvvvv')
        //})

        var btn = document.getElementById('addNewBrand');


        var type = 0;
        var order = {brand: 'asc', agency: 'asc'};
        var pageNow = 1;
        $('#myTabs a.showlist').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
            $(this).addClass('active').siblings('a').removeClass('active');
            type = $(this).data('type');
            var orderNow;
            if (type == 0) {
                orderNow = order.brand;
            } else {
                orderNow = order.agency;
            }
            $("#tab-content").load("/admin/brand?order=" + orderNow + "&type=" + type + " #tab-content>div", function () {
                for (var key in order) {
                    if (order[key] == 'asc') {
                        $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-up');
                    } else {
                        $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-down');
                    }
                }
            });
        });
        $(document).on('click', '.page', function (e) {
            var current_page = $(this).data('page');
            pageNow = current_page;
            var orderNow;
            if (type == 0) {
                orderNow = order.brand;
            } else {
                orderNow = order.agency;
            }
            window.history.pushState(null, null, "/admin/brand?order=" + orderNow + "&current_page=" + current_page + "&type=" + type);
            $("#tab-content").load("/admin/brand?order=" + orderNow + "&current_page=" + current_page + "&type=" + type + " #tab-content>div", function () {
                for (var key in order) {
                    if (order[key] == 'asc') {
                        $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-up');
                    } else {
                        $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-down');
                    }
                }
            });
        });
        $('#brandNameModel').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('name') // Extract info from data-* attributes
            var experimentId = button.data('id');
            var modal = $(this)
            modal.find('.modal-title').text('修改品牌名称 ' + (recipient ? recipient : ''))
            modal.find('.modal-body input[name="brandName"]').val(recipient)
            modal.find('.modal-header input[name="brandId"]').val(experimentId)
        });

        for (var key in order) {
            if (order[key] == 'asc') {
                $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-up');
            } else {
                $("." + key + "-click-sort").find("span").addClass('glyphicon-chevron-down');
            }
        }

        /**
         * 排序-经销商
         */
        $(document).on("click", ".agency-click-sort", function () {
            if (order.agency == 'asc') {
                order.agency = 'desc';
            } else {
                order.agency = 'asc';
            }
            $("#tab-content").load("/admin/brand?current_page=" + pageNow + "&order=" + order.agency + "&type=" + type + " #tab-content>div", function () {
                if (order.agency == 'asc') {
                    $(".agency-click-sort").find('span').addClass('glyphicon-chevron-up');
                } else {
                    $(".agency-click-sort").find('span').addClass('glyphicon-chevron-down');
                }
            });
        })

        /**
         * 排序-品牌
         */
        $(document).on("click", ".brand-click-sort", function () {
            if (order.brand == 'asc') {
                order.brand = 'desc';
            } else {
                order.brand = 'asc';
            }
            $("#tab-content").load("/admin/brand?current_page=" + pageNow + "&order=" + order.brand + "&type=" + type + " #tab-content>div", function () {
                if (order.brand == 'asc') {
                    $(".brand-click-sort").find('span').addClass('glyphicon-chevron-up');
                } else {
                    $(".brand-click-sort").find('span').addClass('glyphicon-chevron-down');
                }
            });
        })

        /**
         * 添加品牌
         */
        $("#add_brand").click(function (event) {
            console.log('kdalfaslfj');
            var brand_name = $("input[name='addBrandName']").val();
            var index = layer.load(1, {
                shade: [0.1, '#fff'] //0.1透明度的白色背景
            });
            $.ajax({
                url: '/admin/addBrand',
                type: 'post',
                dataType: 'json',
                data: {
                    brand_name: brand_name
                },
                success: function (res) {
                    layer.closeAll('loading')
                    if (res.res) {
                        layer.msg(res.msg, {icon: 1}, function (e) {
                            location.reload();
                        });
                    } else {
                        layer.msg(res.msg, {icon: 0});
                    }
                },
                error: function (err) {
                    layer.closeAll('loading');
                    layer.msg(err.message, {icon: 0});
                }
            })
        });

        /**
         * 修改品牌名称
         */
        $("#modify_brand_name").click(function (event) {
            var brandName = $("input[name='brandName']").val();
            var brandId = $("input[name='brandId']").val();
            var index = layer.load(1, {
                shade: [0.1, '#fff'] //0.1透明度的白色背景
            });
            $.ajax({
                url: '/admin/modifyBrandName',
                type: 'put',
                dataType: 'json',
                data: {
                    brand_name: brandName,
                    brand_id: brandId

                },
                success: function (res) {
                    layer.closeAll('loading')
                    if (res.res) {
                        layer.msg(res.msg, {icon: 1}, function (e) {
                            location.reload();
                        });
                    } else {
                        layer.msg(res.msg, {icon: 0});
                    }
                },
                error: function (err) {
                    layer.closeAll('loading');
                    layer.msg(err.message, {icon: 0});
                }
            })
        });

        /**
         * 删除品牌
         */
        $(document).on("click", ".delete_brand", function () {
            var that = this;
            layer.confirm('您确定删除该品牌？', {
                btn: ['确定', '取消'] //按钮
            }, function () {
                if ($(that).data('e_count') > 0 || $(that).data('z_count') > 0) {
                    layer.msg("该品牌下面有pdf数量不为0 不能删除", {icon: 0});
                    return;
                }
                var index = layer.load(1, {
                    shade: [0.1, '#fff'] //0.1透明度的白色背景
                });
                $.ajax({
                    url: '/admin/deleteBrand',
                    type: 'delete',
                    dataType: 'json',
                    data: {
                        brand_id: $(that).data('id')
                    },
                    success: function (res) {
                        layer.closeAll('loading')
                        if (res.res) {
                            layer.msg(res.msg, {icon: 1}, function (e) {
                                $(that).parents("tr").remove();
                            });
                        }
                    },
                    error: function (err) {
                        layer.closeAll('loading')
                    }
                });
            }, function () {

            });
        });


        /**
         * 打开修改经销商页面
         */
        $('#agencyNameModel').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('name') // Extract info from data-* attributes
            var agency_id = button.data('id') // Extract info from data-* attributes
            var agency_status = button.data('status');
            var modal = $(this)
            modal.find('.modal-body input[name="agency_name"]').val(recipient);
            modal.find('.modal-header input[name="agency_id"]').val(agency_id);
            modal.find('.modal-body select[name="agency_status"] option').each(function (event) {
                if ($(this).attr('value') == agency_status) {
                    $(this).attr("selected", true);
                }
            });
        });

        /**
         * 添加经销商
         */
        $("#add_agency").click(function (event) {
            var agency_name = $("input[name='agencyName']").val();
            var agency_status = $("select[name='agencyStatus']").val();
            var index = layer.load(1, {
                shade: [0.1, '#fff'] //0.1透明度的白色背景
            });
            $.ajax({
                url: '/admin/addAgency',
                type: 'post',
                dataType: 'json',
                data: {
                    agency_name: agency_name,
                    agency_status: agency_status
                },
                success: function (res) {
                    layer.closeAll('loading')
                    if (res.res) {
                        layer.msg(res.msg, {icon: 1}, function (e) {
                            location.reload();
                        });
                    } else {
                        layer.msg(res.msg, {icon: 0});
                    }
                },
                error: function (err) {
                    layer.closeAll('loading');
                    layer.msg(err.message, {icon: 0});
                }
            })
        });
        /**
         * 修改经销商
         */
        $("#modify_agency_name").click(function (event) {
            var agencyName = $("input[name='agency_name']").val();
            var agencyStatus = $("select[name='agency_status']").val();
            var agencyId = $("input[name='agency_id']").val();
            var index = layer.load(1, {
                shade: [0.1, '#fff'] //0.1透明度的白色背景
        });
            $.ajax({
                url: '/admin/modifyAgencyName',
                type: 'post',
                dataType: 'json',
                data: {
                    agency_name: agencyName,
                    agency_status: agencyStatus,
                    agency_id: agencyId
                },
                success: function (res) {
                    if (res.res) {
                        layer.msg(res.msg, {icon: 1}, function (e) {
                            location.reload();
                        });
                    } else {
                        layer.msg(res.msg, {icon: 0});
                    }
                },
                error: function (err) {
                    layer.closeAll('loading');
                    layer.msg(err.message, {icon: 0});
                }
            })
        });

        /**
         * 删除经销商
         */
        $(document).on("click", ".delete_agency", function () {
            var that = this;
            layer.confirm('您确定删除该经销商吗？', {
                btn: ['确定', '取消'] //按钮
            }, function () {
                if ($(that).data('goods_count') > 0) {
                    layer.msg("该经销商下面货物数量不为0 不能删除", {icon: 0});
                    return;
                }
                var index = layer.load(1, {
                    shade: [0.1, '#fff'] //0.1透明度的白色背景
                });
                $.ajax({
                    url: '/admin/deleteAgency',
                    type: 'delete',
                    dataType: 'json',
                    data: {
                        agency_id: $(that).data('id')
                    },
                    success: function (res) {
                        layer.closeAll('loading')
                        if (res.res) {
                            layer.msg(res.msg, {icon: 1}, function (e) {
                                $(that).parents("tr").remove();
                            });
                        } else {
                            layer.msg(res.msg, {icon: 0});
                        }
                    },
                    error: function (err) {
                        layer.closeAll('loading');
                        layer.msg(err.message, {icon: 0});
                    }
                });
            }, function () {

            })
        });
    });

</script>
</body>

</html>